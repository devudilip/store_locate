  <script type="text/javascript" src="http://code.jquery.com/jquery-1.8.3.js"></script>    
  <link rel="stylesheet" type="text/css" href="http://aehlke.github.com/tag-it/css/jquery.tagit.css">      
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.12/jquery-ui.min.js"></script>
  <script type="text/javascript" src="http://aehlke.github.com/tag-it/js/tag-it.js"></script>
  <link rel="stylesheet" type="text/css" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1/themes/flick/jquery-ui.css">


 
<link rel="stylesheet" type="text/css" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1/themes/flick/jquery-ui.css">
<%#= stylesheet_link_tag "jquery-tagit", :media => "all" %>
 
 <div class="row">
  <div class="col-lg-12">
    <!--<form class="navbar-form" role="search" method="get" id="search-form" name="search-form">-->
    

      <%= form_tag(locate_stores_path, :method => :get ) do %>
      <div class="input-group search-bar">

      <!--<input type="text" class="form-control" placeholder="Search Products" id="query" name="query" value="" required>-->
        <div id="div_ajax" >
           <ul id="mytags">
          </ul>
          <%= text_field_tag 'query', params[:query], :class=>"form-control", :placeholder => "Search Products"   %>
        </div>
        
        <div class="input-group-btn">
          <!--<button type="submit" class="btn btn-success"><i class="fa fa-search"></i></button>-->
          <%= submit_tag 'Search', :class=>"btn btn-success", :value=>"Search"%><i class="fa fa-search"></i>
        </div>
      </div>
      <%end%>
    <!--</form>-->
  </div>
  <div class="col-lg-12">
    <div id="map" style="height: 500px;"></div>
  </div>
</div>

<% if params[:query] %>
<%= render "store_product_map" %>
<% else %>
<%= render "locate_map" %>
<% end %>


<script type="text/javascript">

$( document ).ready(function() {

    $(window).load(function(){
    
          $("#mytags").tagit({
              autocomplete: { source: function( request, response ) {},
            minLength: 2 
            }
          });
    
    });//]]> 


    $( "#query" ).keypress(function() {
      if ($("#query").val().length == 2) {
  			$.get("/locate_stores/query_chk/", {
				  search : $("#query").val()
			  }, function(data) {
			     if (data[0] != null) {
			       for (var i = 0; i < data[0].length; i++) {
			         m = data[i].split(":");
			         //m[0] = m[1]
			         alert(m[0]);
			         alert(m[1]);
			         $('#query').append($("<option></option>").attr("value", m[0]).text(m[1]));
			         $("#div_ajax").html(data)
			         //alert('Funz');
			       }
			     }else {
		        	$("#div_ajax").hide();
		      }
			  }); 
		  }
    });
    
});    

</script>